<template>
  <require from="../utility/sort"></require>
  <require from="../utility/pick"></require>
  <require from="../utility/filter"></require>
  <require from="../utility/unique"></require>
  <require from="../search/search-project"></require>
  <div class="container-fluid bg_main">
    <div class="row">
      <search-project></search-project>
      <div class="col-lg-12">
        <div class="page-header">
          <h1>${projectTitle}</h1>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-2">
        <div class="card">
          <div class="card-header">
            <h3>Filters</h3>
          </div>
          <div class="card-block card-sidebar">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4>
                  <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne"><i class="fa fa-plus"></i> Organizations</a>
                </h4>
              </div>
              <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                <div class="panel-body">
                  <ul class="list-group">
                    <li class="list-group-item" repeat.for="organization of projects | unique: { propertyName: 'organization'}">
                      <form>
                        <div class="checkbox">
                          <label>
                            <input type="checkbox" checked.bind="selectedOrganizations" value.bind="organization"> ${organization}
                          </label>
                        </div>
                      </form>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4>
                  <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo"><i class="fa fa-plus"></i> Language</a>
                </h4>
              </div>
              <div id="collapseTwo" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                <div class="panel-body">
                  <ul class="list-group">
                    <li class="list-group-item" repeat.for="language of projects | unique: { propertyName: 'language'}">
                      <form>
                        <div class="checkbox">
                          <label>
                            <input type="checkbox" checked.bind="selectedLanguages" value.bind="language"> ${language}
                          </label>
                        </div>
                      </form>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-10">
        <div class="row">
          <div class="col-lg-12 sort-col">
            <form class="form-inline pull-right">
              <div class="btn-group">
                <label class="${sortDirection == 'descending' ? 'btn btn-default active' : 'btn btn-default'}">
                  <input type="radio" name="sortDirection" checked.bind="$parent.sortDirection" autocomplete="off" value="descending"><i class="fa fa-chevron-down" aria-hidden="true"></i>
                </label>
                <label class="${sortDirection == 'ascending' ? 'btn btn-default active' : 'btn btn-default'}">
                  <input type="radio" name="sortDirection" checked.bind="$parent.sortDirection" autocomplete="off" value="ascending"><i class="fa fa-chevron-up" aria-hidden="true"></i>
                </label>
              </div>
              <div class="form-group">
                <label for="sortProperty" class="sr-only">Sort</label>
                <select id="sortProperty" ref="sortProperty" class="form-control">
                  <option value="stars">Stars</option>
                  <option value="watchers">Watchers</option>
                  <option value="releases">Releases</option>
                  <option value="commits">Commits</option>
                  <option value="contributors">Contributors</option>
                </select>
              </div>
            </form>
          </div>

          <div class="col-lg-12">
            <div repeat.for="repo of projects | sort: { propertyName: sortProperty.value, direction: sortDirection} | filter: { propertyName: 'organization', filterArray: selectedOrganizations}:selectedOrganizations.length | filter: { propertyName: 'language', filterArray: selectedLanguages}:selectedLanguages.length" class="clearfix col-lg-6">
              <div class="card">
                <div class="card-header">
                  <h2 class="repo-name"><a route-href="route:project-details-popular; params.bind: {id:repo.id}">${repo.project_name}</a></h2>
                  <h5 class="repo-language">
                    <span if.bind="repo.language === 'JavaScript'"><img class="project-icon" alt="JavaScript Icon" title="JavaScript Icon" src="../../img/logos/javascript.svg"></span>
                    <span if.bind="repo.language === 'Ruby'"><img class="project-icon" alt="Ruby Icon" title="Ruby Icon" src="../../img/logos/ruby.svg"></span>
                    <span if.bind="repo.language === 'Java'"><img class="project-icon java-icon" alt="Java Icon" title="Java Icon" src="../../img/logos/java.svg"></span>
                    <span if.bind="repo.language === 'HTML'"><img class="project-icon" alt="HTML Icon" title="HTML Icon" src="../../img/logos/html5.svg"></span>
                    <span if.bind="repo.language === 'CoffeeScript'"><img class="project-icon coffee-icon" alt="Coffeescript Icon" title="Coffeescript Icon" src="../../img/logos/coffeescript.svg"></span>
                    <span if.bind="repo.language === 'Python'"><img class="project-icon" alt="Python Icon" title="Python Icon" src="../../img/logos/python.svg"></span>
                    <span if.bind="repo.language === 'Groovy'"><img class="project-icon groovy-icon" alt="Groovy Icon" title="Groovy Icon" src="../../img/logos/Groovy-logo.svg"></span>
                    <span if.bind="repo.language === 'Shell'"><img class="project-icon" alt="Shell Icon" title="Shell Icon" src="../../img/logos/terminal.svg"></span>
                    <span if.bind="repo.language === 'Scala'"><img class="project-icon" alt="Scala Icon" title="Scala Icon" src="../../img/logos/scala.svg"></span>
                    <span if.bind="repo.language === 'null'"></span>
                  </h5>
                </div>

                <div class="card-subheader">
                  <h4 class="card-subtitle text-muted">${repo.organization}</h4>
                </div>

                <div class="card-block">
                  <div class="repo-descrip">${repo.project_description}</div>
                  <ul class="repo-stats">
                    <li class="flex-item">
                      <span class="octicon octicon-star"></span> Stars <span class="badge">${repo.stars}</span>
                    </li>
                    <li class="flex-item">
                      <span class="octicon octicon-organization"></span> Contributors <span class="badge">${repo.contributors}</span>
                    </li>
                    <li class="flex-item">
                      <span class="octicon octicon-eye"></span> Watchers <span class="badge">${repo.watchers}</span>
                    </li>
                    <li class="flex-item">
                      <span class="octicon octicon-git-commit"></span> Commits <span class="badge">${repo.commits}</span>
                    </li>
                    <li class="flex-item">
                      <span class="octicon octicon-tag"></span> Releases <span class="badge">${repo.releases}</span>
                    </li>
                  </ul>
                </div>

                <div class="card-footer">
                  <ul class="flex-footer">
                    <li class="flex-item ">
                      <button class="btn btn-secondary btn-sm" click.trigger = "openModal(repo)"><span class="octicon octicon-book"></span> Readme</button>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
  </div>
</template>
