<template>
  <require from="../resources/value-converters/pick"></require>
  <require from="../resources/value-converters/skip"></require>
  <require from="../resources/value-converters/num"></require>
  <require from="../resources/value-converters/ago"></require>

  <div class="container-fluid cards-wrapper proj-details-wrapper">
    <div class="row flex-row">
      <div class="col-lg-9 col-md-9 col-content">
        <div class="row proj-nav">
          <div class="col-lg-12">
            <span class="pull-left">
              <button onclick="window.history.go(-1); return false;" class="btn btn-link btn-sm"><i class="material-icons">chevron_left</i> Back</button>
            </span>
            <span class="pull-right"></span>
          </div>
        </div>
        <div class="row proj-content">
          <div class="col-lg-12">
            <div class="card full-width">
              <div class="ribbon-wrapper">
                <div class="ribbon">${repo.language}</div>
              </div>
              <div class="row">
                <div class="col-lg-8">
                  <div class="lined-header">
                    <a class="pull-right btn btn-link" href="${repo.repositoryUrl}" target="_blank"><i class="material-icons">open_in_new</i>View on Github</a>
                    <h2 class=""><span>overview</span></h2>
                  </div>
                  <div class="proj-desc">${repo.project_description}</div>
                  <div class="text-muted last-updated">By <a href="https://github.com/${repo.organization}" target="_blanks">${repo.organization}</a> &nbsp; | &nbsp; Updated ${repo.updatedAt | ago} <span class="pull-right repo-status"><i class="material-icons">${repo.origin == 'PUBLIC' ? 'public' : 'business'}</i> ${repo.origin}</span></div>

                  <ul class="list-inline">
                    <li><button click.trigger="openReadmeModal(repo)" class="btn btn-secondary"><i class="material-icons">library_books</i> Show README</button></li>
                    <li><button class="btn btn-link"><i class="material-icons">insert_drive_file</i> Show Build File</button></li>
                  </ul>
                </div>
                <div class="col-lg-4 col-github-stats">
                  <div class="row github-stats">
                    <div class="col-md-6 col-sm-6">
                      <span class="stat">
                        <span class="octicon octicon-star"></span>
                        <span class="num text-muted text-emphasized">${repo.stars | num}</span>
                        <span class="stat-label">stars</span>
                      </span>
                      <span class="stat">
                        <span class="octicon octicon-organization"></span>
                        <span class="num text-muted text-emphasized">${repo.contributors | num}</span>
                        <span class="stat-label">contributors</span>
                      </span>
                      <span class="stat">
                        <span class="octicon octicon-eye"></span>
                        <span class="num text-muted text-emphasized">${repo.watchers | num}</span>
                        <span class="stat-label">watchers</span>
                      </span>
                    </div>
                    <div class="col-md-6 col-sm-6">
                      <span class="stat">
                        <span class="octicon octicon-git-commit"></span>
                        <span class="num text-muted text-emphasized">${repo.commits | num:1}</span>
                        <span class="stat-label">commits</span>
                      </span>
                      <span class="stat">
                        <span class="octicon octicon-tag"></span>
                        <span class="num text-muted text-emphasized">${repo.releases | num}</span>
                        <span class="stat-label">releases</span>
                      </span>
                      <span class="stat">
                        <span class="octicon octicon-repo-forked"></span>
                        <span class="num text-muted text-emphasized">${repo.forks | num}</span>
                        <span class="stat-label">forks</span>
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row proj-overview-row">
                <div class="col-lg-4">
                  <h3>Projects that we use</h3>
                  <div class="row">
                    <div class="col-lg-6">
                      <ul class="list-unstyled">
                        <li repeat.for="depend of repo.componentDependencies | pick:numDepends" if.bind = "$even"><strong>${depend.artifactId}</strong><small class="text-muted">${depend.version}</small></li>
                      </ul>
                    </div>
                    <div class="col-lg-6">
                      <ul class="list-unstyled">
                        <li repeat.for="depend of repo.componentDependencies | pick:numDepends" if.bind = "$odd"><strong>${depend.artifactId}</strong><small class="text-muted">${depend.version}</small></li>
                      </ul>
                    </div>
                    <div class="collapse" id="collapseDepend">
                      <div class="col-lg-6">
                        <ul class="list-unstyled">
                          <li repeat.for="depend of repo.componentDependencies | skip:numDepends" if.bind = "$even"><strong>${depend.artifactId}</strong><small class="text-muted">${depend.version}</small></li>
                        </ul>
                      </div>
                      <div class="col-lg-6">
                        <ul class="list-unstyled">
                          <li repeat.for="depend of repo.componentDependencies | skip:numDepends" if.bind = "$odd"><strong>${depend.artifactId}</strong><small class="text-muted">${depend.version}</small></li>
                        </ul>
                      </div>
                    </div>
                  </div>

                  <button if.bind="repo.componentDependencies.length > numDepends" id="showMoreBtn" class="btn btn-link btn-sm" data-toggle="collapse" click.delegate="dependCollapsed = dependCollapsed !== true" href="#collapseDepend">
                    <template if.bind="dependCollapsed">Show More <i class="material-icons">expand_more</i></template>
                    <template if.bind="!dependCollapsed">Show Less <i class="material-icons">expand_less</i></template>
                  </button>

                </div>
                <div class="col-lg-4">
                  <h3>Projects that use us</h3>
                  <div class="empty-state">
                    <i class="material-icons">sentiment_dissatisfied</i>
                    <em class="text-muted">Coming soon</em>
                    <a href="#">Make Project Reusable</a>
                  </div>
                </div>
                <div class="col-lg-4">
                  <h3>Key technologies</h3>
                  <div class="empty-state">
                    <i class="material-icons">access_time</i>
                    <em class="text-muted">Coming soon</em>
                  </div>
                </div>
              </div>
            </div>

            <div class="card full-width">
              <div class="lined-header">
                <h2 class=""><span>Health Statistics</span></h2>
              </div>
              <div class="row proj-overview-row">
                <div class="col-lg-3">
                  <h3>Build</h3>
                  <div class="empty-state">
                    <i class="material-icons">access_time</i>
                    <em class="text-muted">Coming soon</em>
                  </div>
                </div>
                <div class="col-lg-6">
                  <h3>Quality</h3>
                  <div class="row">
                    <div class="col-lg-3 col-md-6 grade-wrapper">
                      <h5>Releasability</h5>
                      <div class="grade-circle empty-circle">
                        <i class="material-icons">access_time</i>
                      </div>
                      <ul class="list-unstyled">
                        <li>Coming Soon</li>
                      </ul>
                    </div>
                    <div class="col-lg-3 col-md-6 grade-wrapper">
                      <h5>Maintainability</h5>
                      <div class="grade-circle rating-${health.sqale_rating.data}">
                        ${health.sqale_rating.data}
                      </div>
                      <ul class="list-unstyled">
                        <li>${health.code_smells.val} code smells</li>
                        <li>${health.complexity.val} complexity</li>
                      </ul>
                    </div>
                    <div class="col-lg-3 col-md-6 grade-wrapper">
                      <h5>Security</h5>
                      <div class="grade-circle rating-${health.security_rating.data}">
                        ${health.security_rating.data}
                      </div>
                      <ul class="list-unstyled">
                        <li>${health.vulnerabilities.val} vulnerabilities</li>
                      </ul>
                    </div>
                    <div class="col-lg-3 col-md-6 grade-wrapper">
                      <h5>Reliability</h5>
                      <div class="grade-circle rating-${health.reliability_rating.data}">
                        ${health.reliability_rating.data}
                      </div>
                      <ul class="list-unstyled">
                        <li>${health.bugs.val} bugs</li>
                        <li>${health.violations.val} violations</li>
                      </ul>
                    </div>
                  </div>
                  <a class="btn btn-link" href="http://54.173.204.117:9000/" target="_blank"><i class="material-icons">open_in_new</i> View on SonarQube</a>
                </div>
                <div class="col-lg-3">
                  <h3>Security</h3>
                  <div class="empty-state">
                    <i class="material-icons">access_time</i>
                    <em class="text-muted">Coming soon</em>
                  </div>
                  <a class="btn btn-link" href="#" target="_blank"><i class="material-icons">open_in_new</i> View on Fortify</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-3 col-md-3 col-sidebar">
        <div class="row card-btns">
          <div class="col-md-6">
            <a href="#"><i class="material-icons">bookmark_border</i> Bookmark</a>
          </div>
          <div class="col-md-6">
            <a href="#"><i class="material-icons">share</i> Share</a>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-12">
            <h3>Contributors</h3>
            <div class="media-list media-list-users list-group">
              <template repeat.for="contrib of repo.contributors_list | pick:5">
                <a href="${contrib.profile_url}" target="_blank" class="list-group-item">
                  <span class="media">
                    <span class="media-left">
                      <img class="img-circle media-object" src="${contrib.avatar_url}" onError="this.onerror=null;this.src='/img/language-icons/unknown-user.svg';">
                    </span>
                    <span class="media-body clearfix">
                      <h5>${contrib.username}<span class="pull-right"></span></h5>
                      <span class="media-body-secondary">${contrib.profile_url}</span>
                    </span>
                  </span>
                </a>
              </template>

            </div>
            <div class="clearfix">
              <a if.bind="repo.contributors_list.length > 5" href="#" click.delegate="openContribModal(repo)" class="">View All</a>
            </div>

            <h3>Similar Projects</h3>
            <div class="media-list media-list-projects list-group">
              <template repeat.for="project of similarProjects | pick:3">
                <a route-href="route:project-details; params.bind: {id:project.project_id}" target="_blank" class="list-group-item">
                  <span class="media">
                    <span class="media-left">
                      <img class="img-circle media-object" src="https://github.com/${project.project_org_name}.png" onError="this.onerror=null;this.src='/img/language-icons/organization-default.svg';">
                    </span>
                    <span class="media-body clearfix">
                      <h5>${project.project_name}</h5>
                      <span class="media-body-secondary">${project.project_org_name}</span>
                    </span>
                  </span>
                </a>
              </template>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
